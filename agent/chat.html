<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat - Agent Dashboard</title>

  <!-- Bootstrap + Icons + Animations -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="agenStyle.css">
</head>

<body>
  <!-- ✅ Unified Navbar (same as main dashboard) -->
  <nav class="navbar navbar-light fixed-top shadow-sm bg-white border-bottom">
    <div class="container-fluid d-flex justify-content-between align-items-center px-4">
      <h3 class="mb-0 text-secondary fw-semibold">Agent Dashboard</h3>
      <ul class="nav nav-tabs border-0 flex-nowrap">
        <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="clients.html">Clients</a></li>
        <li class="nav-item"><a class="nav-link" href="bookings.html">Bookings</a></li>
        <li class="nav-item"><a class="nav-link" href="properties.html">Properties</a></li>
      </ul>
      <button class="btn btn-outline-primary btn-sm">View Profile</button>
    </div>
  </nav>

  <!-- ✅ Chat Container -->
  <div class="container-fluid mt-5 pt-4">
    <h4 class="fw-bold text-secondary mb-3">💬 Chat</h4>

    <div class="chat-container shadow-sm rounded-4 overflow-hidden bg-white animate__animated animate__fadeInUp d-flex">
      <!-- Sidebar -->
      <div class="chat-sidebar border-end" id="sidebar">
        <div class="chat-search p-3 border-bottom d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center w-100">
            <input type="text" id="searchInput" class="form-control rounded-pill me-2" placeholder="Search clients...">
            <button id="toggleSidebar" class="btn btn-sm btn-outline-primary">
              <i class="bi bi-pin"></i>
            </button>
          </div>
        </div>

        <div class="chat-list p-2 overflow-auto" style="max-height: 75vh;">
          <div class="chat-item d-flex align-items-center gap-3 p-2 rounded hover-bg" data-name="Helena">
            <img src="https://via.placeholder.com/45" class="rounded-circle shadow-sm" alt="">
            <div>
              <strong>Helena</strong><br>
              <small class="text-muted">Last message: Hi!</small>
            </div>
          </div>

          <div class="chat-item d-flex align-items-center gap-3 p-2 rounded hover-bg" data-name="Daniel Jay Park">
            <img src="https://via.placeholder.com/45" class="rounded-circle shadow-sm" alt="">
            <div>
              <strong>Daniel Jay Park</strong><br>
              <small class="text-muted">Last message: Sure!</small>
            </div>
          </div>

          <div class="chat-item d-flex align-items-center gap-3 p-2 rounded hover-bg" data-name="Mark Rojas">
            <img src="https://via.placeholder.com/45" class="rounded-circle shadow-sm" alt="">
            <div>
              <strong>Mark Rojas</strong><br>
              <small class="text-muted">Last message: Thanks!</small>
            </div>
          </div>

          <div class="chat-item d-flex align-items-center gap-3 p-2 rounded hover-bg" data-name="Sophia Dela Cruz">
            <img src="https://via.placeholder.com/45" class="rounded-circle shadow-sm" alt="">
            <div>
              <strong>Sophia Dela Cruz</strong><br>
              <small class="text-muted">Last message: See you!</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Hover zone to reopen sidebar -->
      <div id="hoverZone"></div>

      <!-- Main Chat Area -->
      <div class="chat-main d-flex flex-column flex-grow-1 bg-light" id="chatMain">
        <div class="chat-header bg-white p-3 border-bottom fw-semibold d-flex justify-content-between align-items-center">
          <span id="chatHeader">Select a client</span>
        </div>

        <div class="chat-messages flex-grow-1 p-4 overflow-auto d-flex flex-column gap-2" id="chatMessages" style="min-height: 60vh;">
          <p class="text-muted text-center">No conversation selected.</p>
        </div>

        <div class="chat-input bg-white border-top p-3 d-flex align-items-center gap-2">
          <input type="text" id="messageInput" class="form-control rounded-pill" placeholder="Type a message..." disabled>
          <button class="btn btn-primary rounded-circle d-flex align-items-center justify-content-center" disabled>
            <i class="bi bi-send-fill"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const chatItems = document.querySelectorAll('.chat-item');
    const chatHeader = document.getElementById('chatHeader');
    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.querySelector('.chat-input button');
    const toggleSidebar = document.getElementById('toggleSidebar');
    const sidebar = document.getElementById('sidebar');
    const chatMain = document.getElementById('chatMain');
    const hoverZone = document.getElementById('hoverZone');

    // Collapsible toggle state
    let collapsibleEnabled = false;

    // ✅ Toggle collapsible mode (Pin/Unpin)
    toggleSidebar.addEventListener('click', () => {
      collapsibleEnabled = !collapsibleEnabled;

      if (collapsibleEnabled) {
        toggleSidebar.innerHTML = `<i class="bi bi-pin-angle"></i>`;
        sidebar.classList.add('collapsed');
        chatMain.classList.add('expanded');
      } else {
        toggleSidebar.innerHTML = `<i class="bi bi-pin"></i>`;
        sidebar.classList.remove('collapsed');
        chatMain.classList.remove('expanded');
      }
    });

    // ✅ Hover to reopen sidebar only if collapsible mode is ON
    hoverZone.addEventListener('mouseenter', () => {
      if (collapsibleEnabled) {
        sidebar.classList.remove('collapsed');
        chatMain.classList.remove('expanded');
      }
    });

    sidebar.addEventListener('mouseleave', () => {
      if (collapsibleEnabled && !sidebar.matches(':hover')) {
        sidebar.classList.add('collapsed');
        chatMain.classList.add('expanded');
      }
    });

    // ✅ Dummy conversations
    const conversations = {
      "Helena": [
        { from: "client", text: "Hello, I’d like to inquire about my booking." },
        { from: "agent", text: "Hi Helena! Sure, what would you like to know?" }
      ],
      "Daniel Jay Park": [
        { from: "client", text: "Good afternoon!" },
        { from: "agent", text: "Hey Daniel! How can I help today?" }
      ],
      "Mark Rojas": [
        { from: "client", text: "Is my payment confirmed?" },
        { from: "agent", text: "Yes, it’s successfully processed. 👍" }
      ],
      "Sophia Dela Cruz": [
        { from: "client", text: "Can I change my schedule?" },
        { from: "agent", text: "Sure, please send the new preferred date." }
      ]
    };

    // ✅ Select chat
    chatItems.forEach(item => {
      item.addEventListener('click', () => {
        const name = item.getAttribute('data-name');
        chatHeader.textContent = name;
        chatMessages.innerHTML = "";

        conversations[name].forEach(msg => {
          const div = document.createElement('div');
          div.className = `message ${msg.from} animate__animated animate__fadeInUp p-2 rounded-3`;
          div.style.maxWidth = "75%";
          div.style.wordWrap = "break-word";

          if (msg.from === "agent") {
            div.classList.add("bg-primary", "text-white", "align-self-end");
          } else {
            div.classList.add("bg-white", "border", "align-self-start");
          }

          div.textContent = msg.text;
          chatMessages.appendChild(div);
        });

        messageInput.disabled = false;
        sendButton.disabled = false;
        messageInput.focus();
      });
    });

    // ✅ Search clients
    document.getElementById('searchInput').addEventListener('keyup', function() {
      const filter = this.value.toLowerCase();
      chatItems.forEach(item => {
        const name = item.getAttribute('data-name').toLowerCase();
        item.style.display = name.includes(filter) ? "" : "none";
      });
    });

    // ✅ Send message
    function sendMessage() {
      const text = messageInput.value.trim();
      if (text) {
        const msg = document.createElement('div');
        msg.className = "message agent bg-primary text-white p-2 rounded-3 animate__animated animate__fadeInUp align-self-end";
        msg.style.maxWidth = "75%";
        msg.textContent = text;
        chatMessages.appendChild(msg);
        messageInput.value = "";
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    }

    sendButton.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
