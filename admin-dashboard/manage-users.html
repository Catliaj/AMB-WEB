<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Manage Users | Admin Dashboard</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #141414;
      --panel: #1c1c1c;
      --card: #1f1f1f;
      --text: #e4e4e4;
      --muted: #9ca3af;
      --accent1: #5a5cff;
      --accent2: #bb56ff;
      --accent3: #ff5ca8;
      --shadow: 0 0 12px rgba(0,0,0,0.25);
      font-family: "Montserrat", sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%;
      background: var(--bg);
      color: var(--text);
      font-family: "Montserrat", sans-serif;
    }

    body {
      display: flex;
      overflow: hidden;
    }

    .sidebar {
      width: 230px;
      background: var(--panel);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px 0;
      box-shadow: inset -1px 0 0 #2a2a2a;
      flex-shrink: 0;
      overflow-y: auto;
    }

    .sidebar img { width: 120px; margin-bottom: 30px; }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      padding: 0 22px;
    }

    .nav a {
      color: var(--text);
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      border-radius: 10px;
      transition: all 0.25s ease;
      font-size: 14px;
    }

    .nav a svg { width: 16px; height: 16px; stroke-width: 2; color: var(--muted); }
    .nav a:hover svg, .nav a.active svg { color: var(--text); }
    .nav a:hover, .nav a.active {
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: #fff;
    }

  .profile-box {
    margin-top: auto;
    width: 100%;
    padding: 14px 22px;
    border-top: 1px solid #2a2a2a;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .profile-avatar {
    width: 40px; height: 40px;
    border-radius: 8px;
    background: linear-gradient(135deg, var(--accent1), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    color: #fff; font-weight: 700;
  }

  .profile-info { display: flex; flex-direction: column; font-size: 12px; line-height: 1.3; }
  .profile-info strong { font-size: 13px; color: var(--text); }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 28px 36px;
      overflow-y: auto;
      height: 100vh;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
      flex-wrap: wrap;
      gap: 12px;
    }

    header h1 {
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn {
      background: var(--card);
      border: 1px solid #2a2a2a;
      color: var(--text);
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: 0.2s;
    }

    .btn:hover { border-color: var(--accent2); }
    .btn.primary {
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      border: none;
      color: #fff;
    }

    .filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    input, select {
      background: var(--card);
      border: 1px solid #2a2a2a;
      color: var(--text);
      padding: 6px 10px;
      border-radius: 8px;
      font-family: inherit;
      font-size: 13px;
      outline: none;
    }

    .layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      align-items: start;
      width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    thead { background: #1a1a1a; }
    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #2a2a2a;
      font-size: 13px;
    }

    tbody tr:hover { background: #1b1b1b; }

    td.actions {
      display: flex;
      gap: 6px;
      justify-content: flex-start;
    }

    .icon-btn {
      background: #2a2a2a;
      border: none;
      border-radius: 50%;
      padding: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.2s ease;
    }

    .icon-btn svg { width: 16px; height: 16px; color: var(--text); }
    .icon-btn:hover { background: var(--accent1); }
    .icon-btn.danger:hover { background: var(--accent3); }

    .toggle {
      background: #333;
      border: 1px solid #444;
      border-radius: 20px;
      padding: 4px 10px;
      cursor: pointer;
      font-size: 12px;
      color: var(--muted);
      transition: 0.2s;
    }

    .toggle.active {
      background: var(--accent1);
      color: #fff;
      border-color: var(--accent1);
    }

    .right-panel {
      background: var(--card);
      border-radius: 12px;
      padding: 18px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 10px;
      min-height: 300px;
    }

    .profile-pic img { width: 100px; height: 100px; border-radius: 50%; }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      transition: 0.3s ease;
    }

    .modal-content {
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      width: 400px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-shadow: var(--shadow);
      animation: pop 0.25s ease;
    }

    @keyframes pop {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
    }

    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <aside class="sidebar">
    <img src="amb_logo.png" alt="AMB Logo">
    <nav class="nav">
      <a href="dashboard.html"><i data-lucide="layout-dashboard"></i> Dashboard</a>
      <a href="manage-users.html" class="active"><i data-lucide="users"></i> Manage Users</a>
      <a href="manage-properties.html"><i data-lucide="home"></i> Manage Properties</a>
      <a href="user-bookings.html"><i data-lucide="calendar"></i> User Bookings</a>
      <a href="view-chats.html"><i data-lucide="message-circle"></i> View Chats</a>
      <a href="generate-reports.html"><i data-lucide="bar-chart-2"></i> Generate Reports</a>
    </nav>

    <div class="profile-box">
      <div class="profile-avatar">A</div>
      <div class="profile-info">
        <strong>Admin</strong>
        <span>admin@company.com</span>
      </div>
    </div>
  </aside>

  <section class="main">
    <header>
      <h1><i data-lucide="users"></i> Manage Users</h1>
      <button class="btn primary" id="addUserBtn"><i data-lucide="user-plus"></i> Add User</button>
    </header>

    <div class="filters">
      <input type="text" id="searchInput" placeholder="Search by name...">
      <select id="roleFilter">
        <option value="">All Roles</option>
        <option>Admin</option>
        <option>Agent</option>
        <option>Client</option>
      </select>
      <button class="btn" id="filterBtn"><i data-lucide="search"></i> Filter</button>
    </div>

    <div class="layout">
      <div>
        <table id="userTable">
          <thead>
            <tr>
              <th>UserID</th><th>Name</th><th>Email</th><th>Role</th><th>Status</th><th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <aside class="right-panel" id="userDetails">
        <div class="profile-pic"><img src="https://via.placeholder.com/100" alt="Profile"></div>
        <h3>Select a user to view details</h3>
      </aside>
    </div>
  </section>

  <div class="modal" id="userModal">
    <div class="modal-content">
      <h2><i data-lucide="user-plus"></i> Add/Edit User</h2>
      <input id="firstName" type="text" placeholder="First Name">
      <input id="lastName" type="text" placeholder="Last Name">
      <input id="email" type="email" placeholder="Email">
      <select id="role">
        <option>Admin</option><option>Agent</option><option>Client</option>
      </select>
      <div class="modal-actions">
        <button class="btn" id="closeModal"><i data-lucide="x"></i> Cancel</button>
        <button class="btn primary" id="saveUser"><i data-lucide="check"></i> Save</button>
      </div>
    </div>
  </div>

  <script>
    lucide.createIcons();

    const modal = document.getElementById('userModal');
    const addBtn = document.getElementById('addUserBtn');
    const closeModal = document.getElementById('closeModal');
    const saveUser = document.getElementById('saveUser');
    const userTable = document.querySelector('#userTable tbody');
    const userDetails = document.getElementById('userDetails');
    const searchInput = document.getElementById('searchInput');
    const roleFilter = document.getElementById('roleFilter');

    let editingIndex = null;
    let users = [
      { id: '#001', name: 'John Doe', email: 'john@example.com', role: 'Client', status: 'Approved' },
      { id: '#002', name: 'Jane Smith', email: 'jane@company.com', role: 'Agent', status: 'Pending' },
      { id: '#003', name: 'Alex Johnson', email: 'alex@admin.com', role: 'Admin', status: 'Approved' },
    ];

    function renderTable(filterText = '', filterRole = '') {
      userTable.innerHTML = '';
      users
        .filter(u => u.name.toLowerCase().includes(filterText.toLowerCase()))
        .filter(u => !filterRole || u.role === filterRole)
        .forEach((u, i) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${u.id}</td>
            <td>${u.name}</td>
            <td>${u.email}</td>
            <td>${u.role}</td>
            <td><span class="toggle ${u.status === 'Approved' ? 'active' : ''}" data-index="${i}">${u.status}</span></td>
            <td class="actions">
              <button class="icon-btn" data-edit="${i}" title="Edit"><i data-lucide="edit-3"></i></button>
              <button class="icon-btn danger" data-del="${i}" title="Delete"><i data-lucide="trash-2"></i></button>
              <button class="icon-btn" data-view="${i}" title="View"><i data-lucide="eye"></i></button>
            </td>`;
          userTable.appendChild(tr);
        });
      lucide.createIcons();
    }

    renderTable();

    addBtn.onclick = () => {
      modal.style.display = 'flex';
      editingIndex = null;
      document.querySelectorAll('#userModal input').forEach(i => i.value = '');
    };

    closeModal.onclick = () => modal.style.display = 'none';
    window.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };

    saveUser.onclick = () => {
      const f = document.getElementById('firstName').value.trim();
      const l = document.getElementById('lastName').value.trim();
      const e = document.getElementById('email').value.trim();
      const r = document.getElementById('role').value;
      if (!f || !l || !e) return alert('Please complete all fields.');

      if (editingIndex !== null) {
        users[editingIndex] = { ...users[editingIndex], name: `${f} ${l}`, email: e, role: r };
      } else {
        const id = '#' + String(users.length + 1).padStart(3, '0');
        users.push({ id, name: `${f} ${l}`, email: e, role: r, status: 'Pending' });
      }

      modal.style.display = 'none';
      renderTable(searchInput.value, roleFilter.value);
    };

    userTable.addEventListener('click', e => {
      const btn = e.target.closest('button');
      const toggle = e.target.closest('.toggle');
      if (!btn && !toggle) return;

      if (toggle) {
        const i = toggle.dataset.index;
        users[i].status = users[i].status === 'Approved' ? 'Pending' : 'Approved';
        renderTable(searchInput.value, roleFilter.value);
      }

      if (btn?.dataset.del !== undefined) {
        if (confirm('Delete this user?')) {
          users.splice(btn.dataset.del, 1);
          renderTable(searchInput.value, roleFilter.value);
        }
      }

      if (btn?.dataset.edit !== undefined) {
        editingIndex = btn.dataset.edit;
        const u = users[editingIndex];
        const [f, l] = u.name.split(' ');
        document.getElementById('firstName').value = f;
        document.getElementById('lastName').value = l || '';
        document.getElementById('email').value = u.email;
        document.getElementById('role').value = u.role;
        modal.style.display = 'flex';
      }

      if (btn?.dataset.view !== undefined) {
        const u = users[btn.dataset.view];
        userDetails.innerHTML = `
          <div class="profile-pic"><img src="https://via.placeholder.com/100" alt="Profile"></div>
          <h3>${u.name}</h3>
          <p style="color:var(--muted);">${u.role} • ${u.email}</p>
          <p>Status: <strong>${u.status}</strong></p>`;
      }
    });

    document.getElementById('filterBtn').onclick = () => renderTable(searchInput.value, roleFilter.value);
    searchInput.addEventListener('input', () => renderTable(searchInput.value, roleFilter.value));
    roleFilter.addEventListener('change', () => renderTable(searchInput.value, roleFilter.value));
  </script>
</body>
</html>
